name: Notify Ibraheem on Site Incident

on:
  issues:
    types: [opened]

jobs:
  notify:
    if: >
      github.event.issue.title contains 'Ibraheem Dulmeer' ||
      github.event.issue.title contains 'Park Homes Law' ||
      github.event.issue.title contains 'Holiday Park Law' ||
      github.event.issue.title contains 'Lease Barristers' ||
      github.event.issue.title contains 'Rent Repayment Law'
    runs-on: ubuntu-latest
    steps:
      - name: Send email via Brevo API
        run: |
          curl -X POST https://api.brevo.com/v3/smtp/email \
          -H 'accept: application/json' \
          -H 'api-key: ${{ secrets.BREVO_API_KEY }}' \
          -H 'content-type: application/json' \
          -d '{
                "sender": {
                  "name": "OnezCloud Uptime",
                  "email": "watchdog@onezcloud.uk"
                },
                "to": [
                  { "email": "info@ibraheemdulmeer.com", "name": "Ibraheem Dulmeer" }
                ],
                "cc": [
                  { "email": "watchdog@onezcloud.uk", "name": "Will Young" }
                ],
                "subject": "ðŸš¨ Incident Alert: ${{ github.event.issue.title }}",
                "htmlContent": "<p>Hi Ibraheem,</p><p>One of your monitored sites has been reported as down:</p><ul><li><strong>Issue:</strong> ${{ github.event.issue.title }}</li><li><strong>View full details:</strong> <a href='https://github.com/${{ github.repository }}/issues/${{ github.event.issue.number }}'>GitHub Issue</a></li><li><strong>Status Page:</strong> <a href='https://status.onezcloud.uk'>OnezCloud Status</a></li></ul><p>We'll continue to monitor and notify you once the service is restored.</p><p>-- OnezCloud Uptime (ZapYo Ltd)</p>"
              }'
